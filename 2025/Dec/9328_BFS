#include <iostream>
#include <vector>
#include <queue>
#include <string>
using namespace std;

const int dir[4][2] = { {0,1},{0,-1},{1,0},{-1,0} };

int main() {
	int T; cin >> T;

	while (T--) {
		int h, w;
		cin >> h >> w;

		int res = 0;

		// (h + 2) * (w + 2) 로 만들어서 바깥쪽을 '.'로 채움
		vector<string> board(h + 2, string(w + 2, '.'));

		for (int i = 1; i < h + 1; i++) {
			string s; cin >> s;
			for (int j = 1; j < w + 1; j++) {
				board[i][j] = s[j - 1];
			}
		}

		queue<pair<int, int>> q;
		vector<vector<bool>> visited(h + 2, vector<bool>(w + 2, false));
		
		vector<bool> getKey(26, false);

		string key;
		cin >> key;

		if (key != "0") {
			for (char c : key) getKey[c - 'a'] = true;
		}

		// 열지 못한 문 좌표
		vector<pair<int, int>> waitDoor[26];

		for (int i = 0; i < h + 2; i++) {
			for (int j = 0; j < w + 2; j++) {
				if (i == 0 || i == h + 1 || j == 0 || j == w + 1) {
					q.push({ i, j });
					visited[i][j] = true;
				}
			}
		}

		while (!q.empty()) {
			int currR = q.front().first;
			int currC = q.front().second;
			q.pop();

			for (int i = 0; i < 4; i++) {
				int nextR = currR + dir[i][0];
				int nextC = currC + dir[i][1];

				if (nextR < 0 || nextR >= h + 2 || nextC < 0 || nextC >= w + 2) continue;
				if (visited[nextR][nextC] || board[nextR][nextC] == '*') continue;

				char next = board[nextR][nextC];

				// 빈 공간일 경우
				if (next == '.') {
					q.push({ nextR,nextC });
					visited[nextR][nextC] = true;
				}
				// 문일 경우
				else if (next >= 'A' && next <= 'Z') {
					// 열쇠가 있는 경우
					if (getKey[next - 'A']) {
						q.push({ nextR,nextC });
						visited[nextR][nextC] = true;
					}
					// 없는 경우
					else {
						waitDoor[next - 'A'].push_back({ nextR,nextC });
					}
				}
				// 열쇠를 주운 경우
				else if (next >= 'a' && next <= 'z') {
					// 처음 줍는 열쇠인 경우
					if (!getKey[next - 'a']) {
						getKey[next - 'a'] = true;
            // 해당 알파벳의 모든 문을 큐에 저장 및 방문
						for (auto door : waitDoor[next - 'a']) {
							q.push(door);
							visited[door.first][door.second] = true;
						}
					}
					q.push({ nextR,nextC });
					visited[nextR][nextC] = true;
				}
				// 문서를 발견한 경우
				else if (next == '$') {
					res++;
					q.push({ nextR,nextC });
					visited[nextR][nextC] = true;
				}
			}
		}

		cout << res << "\n";
	}
}
